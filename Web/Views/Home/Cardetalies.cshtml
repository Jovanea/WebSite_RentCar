@{
    ViewBag.Title = "Cardetalies";
    var carId = ViewBag.CarId != null ? ViewBag.CarId : 1;
}

@Html.Partial("_Header")

<section class="car-details">
    <div class="container">
        <a href="@Url.Action("Carsection", "Home")" class="back-to-cars">
            <i class="fa-solid fa-arrow-left"></i> Înapoi la mașini
        </a>

        <div class="car-details-content">
            <!-- Range Rover -->
            @if (carId == 1)
            {
                <div class="car-images">
                    <div class="main-image">
                        <img src="/Content/images/cars_pexels_1.jpg" alt="Range Rover" id="main-car-image">
                    </div>
                    <div class="thumbnails">
                        <img src="/Content/images/cars_pexels_1.jpg" alt="Range Rover" onclick="changeImage(this.src)">
                        <img src="/Content/images/range_interior.jpg" alt="Range Rover Interior" onclick="changeImage(this.src)">
                        <img src="/Content/images/range_rear.jpg" alt="Range Rover Spate" onclick="changeImage(this.src)">
                    </div>
                </div>

                <div class="car-basic-info">
                    <h2>Range Rover</h2>
                    <h3>Land Rover Range 4.0</h3>

                    <div class="price-tag">
                        <span class="price">$60</span>
                        <span class="period">/zi</span>
                    </div>

                    <div class="car-specs">
                        <div class="spec-item">
                            <i class="fa-solid fa-calendar"></i>
                            <span>An: 2020</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gears"></i>
                            <span>Cutie: Automată</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gas-pump"></i>
                            <span>Combustibil: Diesel</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gauge-high"></i>
                            <span>Putere: 340 CP</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-user-group"></i>
                            <span>Locuri: 5</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-car"></i>
                            <span>Categorie: SUV</span>
                        </div>
                    </div>
                </div>
            }

            <!-- Mercedes -->
            @if (carId == 2)
            {
                <div class="car-images">
                    <div class="main-image">
                        <img src="/Content/images/cars_pexels_2.jpg" alt="Mercedes" id="main-car-image">
                    </div>
                    <div class="thumbnails">
                        <img src="/Content/images/cars_pexels_2.jpg" alt="Mercedes" onclick="changeImage(this.src)">
                        <img src="/Content/images/mercedes_interior.jpg" alt="Mercedes Interior" onclick="changeImage(this.src)">
                    </div>
                </div>

                <div class="car-basic-info">
                    <h2>Mercedes</h2>
                    <h3>Mercedes-Benz Maybach 600</h3>

                    <div class="price-tag">
                        <span class="price">$100</span>
                        <span class="period">/zi</span>
                    </div>

                    <div class="car-specs">
                        <div class="spec-item">
                            <i class="fa-solid fa-calendar"></i>
                            <span>An: 2018</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gears"></i>
                            <span>Cutie: Automată</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gas-pump"></i>
                            <span>Combustibil: Benzină</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gauge-high"></i>
                            <span>Putere: 630 CP</span>
                        </div>
                    </div>
                </div>
            }

            <!-- Pagani -->
            @if (carId == 6)
            {
                <div class="car-images">
                    <div class="main-image">
                        <img src="/Content/images/cars_pexels_6.jpg" alt="Pagani" id="main-car-image">
                    </div>
                    <div class="thumbnails">
                        <img src="/Content/images/cars_pexels_6.jpg" alt="Pagani" onclick="changeImage(this.src)">
                        <img src="/Content/images/pagani_interior.jpg" alt="Pagani Interior" onclick="changeImage(this.src)">
                    </div>
                </div>

                <div class="car-basic-info">
                    <h2>Pagani</h2>
                    <h3>Pagani Huayra</h3>

                    <div class="price-tag">
                        <span class="price">$2000</span>
                        <span class="period">/zi</span>
                    </div>

                    <div class="car-specs">
                        <div class="spec-item">
                            <i class="fa-solid fa-calendar"></i>
                            <span>An: 2024</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gears"></i>
                            <span>Cutie: Automată</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gas-pump"></i>
                            <span>Combustibil: Benzină</span>
                        </div>
                        <div class="spec-item">
                            <i class="fa-solid fa-gauge-high"></i>
                            <span>Putere: 840 CP</span>
                        </div>
                    </div>
                </div>
            }

            <!-- Descriere în stânga, Rezervare în dreapta -->
            <div class="centered-content">
                <!-- Partea stângă - Descriere și specificații -->
                <div class="description-section">
                    @if (carId == 1)
                    {
                        <div class="car-description">
                            <h4>Descriere</h4>
                            <p>Range Rover este simbolul luxului și al performanței off-road. Acest SUV de lux oferă confort excepțional, tehnologie de vârf și capacități de conducere impresionante atât în oraș, cât și în afara lui.</p>
                        </div>

                        <div class="specifications">
                            <h4>Specificații tehnice</h4>
                            <table>
                                <tr><td>Motor</td><td>4.0L V8 Turbodiesel</td></tr>
                                <tr><td>Putere</td><td>340 CP</td></tr>
                                <tr><td>Cuplu</td><td>700 Nm</td></tr>
                                <tr><td>Accelerație 0-100 km/h</td><td>6.3 secunde</td></tr>
                                <tr><td>Viteza maximă</td><td>250 km/h</td></tr>
                                <tr><td>Consum mediu</td><td>8.5 l/100 km</td></tr>
                            </table>
                        </div>

                        <div class="car-features">
                            <h4>Dotări</h4>
                            <ul>
                                <li><i class="fa-solid fa-check"></i> Scaune din piele Meridian</li>
                                <li><i class="fa-solid fa-check"></i> Sistem audio premium</li>
                                <li><i class="fa-solid fa-check"></i> Suspensie pneumatică</li>
                            </ul>
                        </div>
                    }
                    @if (carId == 2)
                    {
                        <div class="car-description">
                            <h4>Descriere</h4>
                            <p>Mercedes-Maybach S600 reprezintă vârful luxului automobilistic, cu finisaje de excepție și tehnologie avansată.</p>
                        </div>

                        <div class="specifications">
                            <h4>Specificații tehnice</h4>
                            <table>
                                <tr><td>Motor</td><td>6.0L V12 Biturbo</td></tr>
                                <tr><td>Putere</td><td>630 CP</td></tr>
                                <tr><td>Accelerație 0-100 km/h</td><td>4.6 secunde</td></tr>
                            </table>
                        </div>
                    }
                    @if (carId == 6)
                    {
                        <div class="car-description">
                            <h4>Descriere</h4>
                            <p>Pagani Huayra este o operă de artă pe roți, combinând performanțe extreme cu design uluitor.</p>
                        </div>

                        <div class="specifications">
                            <h4>Specificații tehnice</h4>
                            <table>
                                <tr><td>Motor</td><td>6.0L V12 Twin-Turbo</td></tr>
                                <tr><td>Putere</td><td>840 CP</td></tr>
                                <tr><td>Accelerație 0-100 km/h</td><td>2.8 secunde</td></tr>
                                <tr><td>Viteza maximă</td><td>383 km/h</td></tr>
                            </table>
                        </div>
                    }
                </div>

                <!-- Partea dreaptă - Formular de rezervare -->
                <div class="booking-section">
                    <h4>Rezervă acum</h4>
                    @using (Html.BeginForm("AddToCart", "Home", FormMethod.Post, new { id = "booking-form" }))
                    {
                        <input type="hidden" name="carId" id="carId" value="@carId" />
                        <input type="hidden" name="totalAmount" id="totalAmount" value="0" />

                        <div class="date-picker">
                            <div class="date-input">
                                <label for="pickupDate">Data preluare:</label>
                                <input type="date" id="pickupDate" name="pickupDate" required>
                            </div>
                            <div class="date-input">
                                <label for="returnDate">Data returnare:</label>
                                <input type="date" id="returnDate" name="returnDate" required>
                            </div>
                        </div>

                        <div class="booking-summary">
                            <div class="summary-item">
                                <span>Preț / zi:</span>
                                <span id="daily-price">@(carId == 1 ? "$60" : carId == 2 ? "$100" : carId == 3 ? "$600" : carId == 4 ? "$500" : carId == 5 ? "$700" : carId == 6 ? "$2000" : carId == 7 ? "$5000" : carId == 8 ? "$450" : carId == 9 ? "$1500" : carId == 10 ? "$1000" : carId == 11 ? "$850" : carId == 12 ? "$60" : "$0")</span>
                            </div>
                            <div class="summary-item">
                                <span>Zile:</span>
                                <span id="days-count">0</span>
                            </div>
                            <div class="summary-item total">
                                <span>Total:</span>
                                <span id="total-price">$0</span>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary">
                            <i class="fa-solid fa-cart-plus"></i> Rezervă acum
                        </button>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Funcție pentru schimbarea imaginii principale
    function changeImage(src) {
        document.getElementById('main-car-image').src = src;
    }

    // Calcularea prețului total bazat pe datele selectate
    document.addEventListener('DOMContentLoaded', function () {
        const pickupDateInput = document.getElementById('pickupDate');
        const returnDateInput = document.getElementById('returnDate');
        const daysCountElement = document.getElementById('days-count');
        const totalPriceElement = document.getElementById('total-price');
        const totalAmountInput = document.getElementById('totalAmount');
        const dailyPriceElement = document.getElementById('daily-price');
        const bookingForm = document.getElementById('booking-form');

        // Setează data minimă la ziua curentă
        const today = new Date();
        const formattedDate = today.toISOString().split('T')[0];
        pickupDateInput.min = formattedDate;

        // Funcție pentru calcularea zilelor între două date
        function calculateDays() {
            const pickupDate = new Date(pickupDateInput.value);
            const returnDate = new Date(returnDateInput.value);

            if (pickupDate && returnDate && returnDate >= pickupDate) {
                const diffTime = Math.abs(returnDate - pickupDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            }
            return 0;
        }

        // Funcție pentru actualizarea sumei totale
        function updateTotal() {
            const days = calculateDays();
            daysCountElement.textContent = days;

            const priceString = dailyPriceElement.textContent.replace('$', '');
            const price = parseFloat(priceString);
            const total = days * price;

            totalPriceElement.textContent = '$' + total;
            totalAmountInput.value = total;
        }

        // Adaugă event listener pentru schimbări de date
        pickupDateInput.addEventListener('change', function () {
            // Setează data minimă pentru returnare la data de preluare
            returnDateInput.min = pickupDateInput.value;
            updateTotal();
        });

        returnDateInput.addEventListener('change', updateTotal);

        // Validare formular înainte de trimitere
        bookingForm.addEventListener('submit', function (event) {
            if (calculateDays() <= 0) {
                event.preventDefault();
                alert('Vă rugăm să selectați date valide pentru rezervare.');
            }
        });
    });
</script>